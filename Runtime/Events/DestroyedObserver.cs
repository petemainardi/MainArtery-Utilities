using UnityEngine;
using UnityEngine.Events;

namespace MainArtery.Utilities.Unity
{
    /// ===========================================================================================
    /// |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
    /// ===========================================================================================
    /// <summary>
    /// Notify listeners that this GameObject is being destroyed.
    /// <br/><br/>
    /// NOTE:<br/>
    /// It is possible to misuse this component by destroying it individually instead of its
    /// GameObject. This can cause unexpected behavior unless specifically intending to separate
    /// destruction of the component from that of the GameObject.
    /// </summary>
    /// ===========================================================================================
    /// |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
    /// ===========================================================================================
    [DisallowMultipleComponent]
    public class DestroyedObserver : MonoBehaviour
    {
        /// =======================================================================================
        /// Fields
        /// =======================================================================================
        public UnityEvent<GameObject> Destroyed { get; } = new UnityEvent<GameObject>();

        /// =======================================================================================
        /// Mono
        /// =======================================================================================
        private void OnDestroy()
        {
            Destroyed.Invoke(this.gameObject);
            Destroyed.RemoveAllListeners();
        }
        /// =======================================================================================
    }
    /// ===========================================================================================
    /// |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
    /// ===========================================================================================
}